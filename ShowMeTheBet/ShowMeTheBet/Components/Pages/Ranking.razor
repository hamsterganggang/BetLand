@page "/ranking"
@using ShowMeTheBet.Models
@inject ShowMeTheBet.ViewModels.Page.RankingViewModel ViewModel
@rendermode InteractiveServer
@implements IDisposable

<PageTitle>ë¶€ìë­í‚¹ - ShowMeTheBet</PageTitle>

<div class="ranking-container">
    <div class="ranking-header">
        <h1>ğŸ† ë¶€ìë­í‚¹</h1>
        <p>íšŒì› ë³´ìœ  ê¸ˆì•¡ ìˆœìœ„</p>
    </div>

    <div class="ranking-content">
        @if (ViewModel.Rankings == null)
        {
            <div class="loading">
                <p>ë¡œë”© ì¤‘...</p>
            </div>
        }
        else if (ViewModel.Rankings.Count == 0)
        {
            <div class="empty-ranking">
                <p>ë­í‚¹ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            </div>
        }
        else
        {
            <div class="ranking-list">
                @for (int i = 0; i < ViewModel.Rankings.Count; i++)
                {
                    var user = ViewModel.Rankings[i];
                    var rank = i + 1;
                    var isCurrentUser = ViewModel.IsCurrentUser(user);
                    
                    <div class="ranking-item @(isCurrentUser ? "current-user" : "")">
                        <div class="rank-number">
                            @if (rank == 1)
                            {
                                <span class="rank-icon gold">ğŸ¥‡</span>
                            }
                            else if (rank == 2)
                            {
                                <span class="rank-icon silver">ğŸ¥ˆ</span>
                            }
                            else if (rank == 3)
                            {
                                <span class="rank-icon bronze">ğŸ¥‰</span>
                            }
                            else
                            {
                                <span class="rank-number-text">@rank</span>
                            }
                        </div>
                        <div class="user-info">
                            <div class="username">@user.Username</div>
                            <div class="user-email">@user.Email</div>
                        </div>
                        <div class="balance-info">
                            <div class="balance-amount">@user.Balance.ToString("N0") ì›</div>
                            <div class="balance-label">ë³´ìœ  ê¸ˆì•¡</div>
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    protected override async Task OnInitializedAsync()
    {
        ViewModel.StateChanged += OnViewModelStateChanged;
        await ViewModel.InitializeAsync();
    }

    private void OnViewModelStateChanged() => InvokeAsync(StateHasChanged);

    public void Dispose()
    {
        ViewModel.StateChanged -= OnViewModelStateChanged;
        ViewModel.Dispose();
    }
}

