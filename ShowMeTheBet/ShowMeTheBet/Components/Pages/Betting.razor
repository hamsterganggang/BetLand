@page "/game"
@inject ShowMeTheBet.ViewModels.Game.BettingViewModel ViewModel
@inject NavigationManager Navigation
@implements IDisposable
@rendermode InteractiveServer

<PageTitle>ShowMeTheBet</PageTitle>

@* ë¡œë”© ì¤‘ì¼ ë•Œ í‘œì‹œë˜ëŠ” í™”ë©´ *@
@if (ViewModel.IsLoading)
{
    <div style="text-align: center; padding: 50px;">
        <p>ë¡œë”© ì¤‘...</p>
    </div>
}
@* ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ ìš”ì²­ í™”ë©´ *@
else if (!ViewModel.IsAuthenticated)
{
    <div class="auth-required">
        <div class="auth-message">
            <h2>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
            <p>ë² íŒ…ì„ í•˜ë ¤ë©´ ë¨¼ì € ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
            <button class="btn btn-primary" @onclick="NavigateToLogin">ë¡œê·¸ì¸í•˜ê¸°</button>
        </div>
    </div>
}
@* ì¸ì¦ëœ ê²½ìš° ê²Œì„ ì„ íƒ í™”ë©´ *@
else
{
    <div class="main-container">
        <div class="main-header">
            <h1>âš½ ShowMeTheBet</h1>
            <div class="balance-display">
                <span class="balance-label">ì”ì•¡:</span>
                    <span class="balance-amount">@ViewModel.Balance.ToString("N0") ì›</span>
            </div>
        </div>

        <div class="games-menu">
            <h2>ê²Œì„ ì„ íƒ</h2>
            <div class="games-grid">
                @* ìŠ¤í¬ì¸  í† í†  ê²Œì„ ì¹´ë“œ *@
                <div class="game-card" @onclick="ViewModel.NavigateToSports" role="button" tabindex="0" style="cursor: pointer;">
                    <div class="game-icon">âš½</div>
                    <h3>ìŠ¤í¬ì¸  í† í† </h3>
                    <p>ì‹¤ì‹œê°„ ê²½ê¸° ë² íŒ…</p>
                    <div class="game-badge">ìŠ¤í¬ì¸ </div>
                </div>

                @* í™€ì§ ê²Œì„ ì¹´ë“œ *@
                <div class="game-card" @onclick="ViewModel.NavigateToOddEven" role="button" tabindex="0" style="cursor: pointer;">
                    <div class="game-icon">ğŸ²</div>
                    <h3>í™€ì§</h3>
                    <p>30ì´ˆë§ˆë‹¤ ê²°ê³¼ ë°œí‘œ</p>
                    <div class="game-badge">x2.0</div>
                </div>

                @* ê·¸ë˜í”„ ê²Œì„ ì¹´ë“œ *@
                <div class="game-card" @onclick="ViewModel.NavigateToGraph" role="button" tabindex="0" style="cursor: pointer;">
                    <div class="game-icon">ğŸ“ˆ</div>
                    <h3>ê·¸ë˜í”„</h3>
                    <p>ë°°ìˆ˜ ê²Œì„ (x1 ~ x5)</p>
                    <div class="game-badge">ë°°ìˆ˜</div>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private void NavigateToLogin()
    {
        Navigation.NavigateTo("/login");
    }

    protected override async Task OnInitializedAsync()
    {
        ViewModel.StateChanged += OnViewModelStateChanged;
        await ViewModel.InitializeAsync();
    }

    private void OnViewModelStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        ViewModel.StateChanged -= OnViewModelStateChanged;
        ViewModel.Dispose();
    }
}
